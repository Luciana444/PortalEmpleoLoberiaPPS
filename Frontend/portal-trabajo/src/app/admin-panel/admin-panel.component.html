<app-header></app-header>
<div class="container">
    <!-- TODO: UNCOMENT LATER -->
    <!-- <app-reports></app-reports> -->
    <div class="container-list">
        <mat-accordion>
            <mat-expansion-panel (opened)="panelOpenState.set(true)" (closed)="panelOpenState.set(false)">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h1>Ofertas</h1>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="list-content">
                    @if (offers.length) {
                    @for (offer of offers; track offer.id) {
                    <!-- <li> -->
                    <div class="profile">
                        <!-- Column 1: Offer Name -->
                        <h1 class="name-work">{{offer.puesto_requerido}}</h1>

                        <!-- Column 2: Company & Location -->
                        <div class="company-info">
                            <div class="profile-pic">
                                <img [src]="getImageUrl(offer.logo) || 'sample_pfp.png'" alt="Profile picture">
                            </div>
                            <div class="company-details">
                                <h4>{{offer.nombre_empresa}}</h4>
                                <div class="location">
                                    <i class="fa-solid fa-location-dot"></i>
                                    <p>{{offer.localidad}}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Column 3: Date -->
                        <div class="offer-date">
                            <p>Publicada el: {{convertToLocalDate(offer.fecha_publicacion)}}</p>
                        </div>

                        <!-- Column 4: Button & Status -->
                        <div class="action-column">
                            @if (offer.estado_publicacion === 'pendiente') {
                            <h5 class="state-flag"><i class="fa-solid fa-circle-exclamation"></i>Pendiente</h5>
                            } @else if(offer.estado_publicacion === 'rechazada') {
                            <h5 class="state-flag-reject"><i class="fa-solid fa-xmark"></i>Rechazada</h5>
                            } @else {
                            <h5 class="state-flag-check"><i class="fa-solid fa-check"></i>Aprobada</h5>
                            }
                            <div class="offer-btn">
                                <button (click)="navigateToPostulationDetail(offer.id)">Ver Oferta</button>
                            </div>
                        </div>
                    </div>
                    <!-- </li> -->
                    }
                    }

                </div>
            </mat-expansion-panel>
        </mat-accordion>

        <mat-accordion>
            <mat-expansion-panel (opened)="panelOpenState.set(true)" (closed)="panelOpenState.set(false)">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h1>Empresas</h1>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="list-content">
                    @if (employers.length) {
                    @for (employer of employers; track employer.id_usuario) {
                    <li>
                        <div class="profile-employee">
                            <!-- Column 1: Company Name -->
                            <h1 class="profile-name">{{employer.nombre_empresa}}</h1>

                            <!-- Column 2: Location -->
                            <div class="profile-details">
                                <div class="profile-pic">
                                    <img [src]="getImageUrl(employer.logo) || 'sample_pfp.png'" alt="Profile picture">
                                </div>
                                <div class="profile-info">
                                    <div class="location">
                                        <i class="fa-solid fa-location-dot"></i>
                                        <p>{{employer.localidad}}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 3: Email -->
                            <div class="profile-info-column">
                                <p>@if(employer.email_contacto === null){Email: No informado}@else{Email:
                                    {{employer.email_contacto}}}</p>
                            </div>

                            <!-- Column 4: Status & Button -->
                            <div class="profile-actions">
                                <div class="status-flag">
                                    @if (employer.estado_aprobacion === 'pendiente') {
                                    <h5 class="state-flag"><i class="fa-solid fa-circle-exclamation"></i>Pendiente</h5>
                                    } @else if(employer.estado_aprobacion === 'rechazada') {
                                    <h5 class="state-flag-reject"><i class="fa-solid fa-xmark"></i>Rechazada</h5>
                                    } @else {
                                    <h5 class="state-flag-check"><i class="fa-solid fa-check"></i>Aprobada</h5>
                                    }
                                </div>
                                <div class="profile-btn">
                                    <button (click)="navigateToProfileEmployer(employer.id_usuario)">Ver Perfil</button>
                                </div>
                            </div>
                        </div>
                    </li>
                    }
                    }
                </div>
            </mat-expansion-panel>
        </mat-accordion>

        <mat-accordion>
            <mat-expansion-panel (opened)="panelOpenState.set(true)" (closed)="panelOpenState.set(false)">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h1>Ciudadanos</h1>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="list-content">
                    @if (employees.length) {
                    @for (employee of employees; track employee.id) {
                    <li>
                        <div class="profile-employee">
                            <!-- Column 1: Full Name -->
                            <h1 class="profile-name">{{employee.nombre}} {{employee.apellido}}</h1>

                            <!-- Column 2: Location -->
                            <div class="profile-details">
                                <div class="profile-pic">
                                    <img [src]="getImageUrl(employee.imagen_url) || 'sample_pfp.png'"
                                        alt="Profile picture">
                                </div>
                                <div class="profile-info">
                                    <div class="location">
                                        <i class="fa-solid fa-location-dot"></i>
                                        <p>{{employee.localidad}}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 3: Date of Birth -->
                            <div class="profile-info-column">
                                <p>@if(employee.fecha_nacimiento === null){Fecha no informada}@else{Nacimiento:
                                    {{convertToLocalDate(employee.fecha_nacimiento)}}}</p>
                            </div>

                            <!-- Column 4: CV Status & Button -->
                            <div class="profile-actions">
                                <div class="status-flag">
                                    @if (employee.cv_url === null) {
                                    <h5 class="state-flag"><i class="fa-solid fa-circle-exclamation"></i>Sin CV</h5>
                                    } @else {
                                    <h5 class="state-flag-check"><i class="fa-solid fa-check"></i>CV Adjunto</h5>
                                    }
                                </div>
                                <div class="profile-btn">
                                    <button (click)="navigateToProfile(employee.id_ciudadano)">Ver Perfil</button>
                                </div>
                            </div>
                        </div>
                    </li>
                    }
                    }
                </div>
            </mat-expansion-panel>
        </mat-accordion>

    </div>
</div>
<app-footer></app-footer>